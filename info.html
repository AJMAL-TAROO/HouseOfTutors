<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <!-- SEO Meta Tags -->
    <title>Super Admin Info - House of Tutors | System Dashboard</title>
    <meta name="description" content="View super admin statistics and dashboard logs for House of Tutors platform.">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://www.housesoftutors.com/info.html">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.22/dist/full.min.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .stat-card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        .editable-field {
            border: 1px solid #e2e8f0;
            padding: 0.5rem;
            border-radius: 0.25rem;
            background: white;
            color: #1a202c;
        }
        .editable-field:focus {
            outline: 2px solid #667eea;
        }
        .search-input {
            max-width: 400px;
        }
        
        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .card {
                background-color: #2d3748 !important;
                color: #e2e8f0 !important;
            }
            .card-body {
                color: #e2e8f0 !important;
            }
            .table {
                color: #e2e8f0 !important;
                background-color: #2d3748 !important;
            }
            .table thead {
                background-color: #6b46c1 !important;
            }
            .table-striped tbody tr:nth-of-type(odd) {
                background-color: rgba(45, 55, 72, 0.5) !important;
            }
            .table-hover tbody tr:hover {
                background-color: rgba(102, 126, 234, 0.2) !important;
            }
            .editable-field {
                background: #4a5568 !important;
                color: #e2e8f0 !important;
                border-color: #718096;
            }
            .search-input {
                background-color: #4a5568 !important;
                color: #e2e8f0 !important;
                border-color: #718096 !important;
            }
            .search-input::placeholder {
                color: #a0aec0 !important;
            }
            .tab-content {
                background-color: #2d3748 !important;
                color: #e2e8f0 !important;
            }
            .text-purple-700 {
                color: #b794f4 !important;
            }
            .text-purple-800 {
                color: #d6bcfa !important;
            }
            td, th {
                color: #e2e8f0 !important;
            }
            .form-control {
                background-color: #4a5568 !important;
                color: #e2e8f0 !important;
                border-color: #718096 !important;
            }
            label {
                color: #e2e8f0 !important;
            }
        }
        
        /* Improved responsive design */
        @media (max-width: 768px) {
            .card-body {
                padding: 1rem;
            }
            .table {
                font-size: 0.875rem;
            }
            .btn-sm {
                padding: 0.25rem 0.5rem;
                font-size: 0.75rem;
            }
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <button class="btn btn-dark" onclick="window.location.href='DashboardAdmin.html'">
                <i class="fas fa-arrow-left"></i>
            </button>
            <a class="navbar-brand mx-auto" href="#">House Of Tutors - Super Admin Dashboard</a>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-12">
                <div class="card shadow-lg">
                    <div class="card-body">
                        <h2 class="text-center text-purple-800 font-bold text-3xl mb-5">Super Admin Dashboard</h2>
                        
                        <!-- Tabs -->
                        <div role="tablist" class="tabs tabs-lifted tabs-lg">
                            <input type="radio" name="my_tabs" role="tab" class="tab" aria-label="Tutors" checked />
                            <div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
                                <h3 class="text-2xl font-bold mb-4 text-purple-700">Tutors Management</h3>
                                
                                <!-- Search Bar -->
                                <div class="mb-4">
                                    <input type="text" id="tutorSearch" placeholder="Search tutor by name..." 
                                           class="search-input form-control" onkeyup="filterTutors()">
                                </div>
                                
                                <!-- Tutors List -->
                                <div id="tutorsContainer" class="table-responsive">
                                    <!-- Tutors will be loaded here -->
                                </div>
                            </div>

                            <input type="radio" name="my_tabs" role="tab" class="tab" aria-label="Statistics" />
                            <div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
                                <h3 class="text-2xl font-bold mb-4 text-purple-700">General Statistics</h3>
                                
                                <div class="row" id="statsContainer">
                                    <!-- Stats will be dynamically loaded here -->
                                </div>
                            </div>

                            <input type="radio" name="my_tabs" role="tab" class="tab" aria-label="Students" />
                            <div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
                                <h3 class="text-2xl font-bold mb-4 text-purple-700">Students Management</h3>
                                
                                <!-- Search Bar -->
                                <div class="mb-4">
                                    <input type="text" id="studentSearch" placeholder="Search student by name..." 
                                           class="search-input form-control" onkeyup="filterStudents()">
                                </div>
                                
                                <!-- Students List -->
                                <div id="studentsContainer" class="table-responsive">
                                    <!-- Students will be loaded here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        // Import Firebase modules
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getDatabase, ref, get, set } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-database.js";

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCwol-nlbl1YbdAiU88nYFv67pJg2XOo9U",
            authDomain: "houseoftutors-f398e.firebaseapp.com",
            databaseURL: "https://houseoftutors-f398e-default-rtdb.firebaseio.com/",
            projectId: "houseoftutors-f398e",
            storageBucket: "houseoftutors-f398e.appspot.com",
            messagingSenderId: "1006665226128",
            appId: "1:1006665226128:web:bcf481758d361da3ef8515",
            measurementId: "G-PEM636J9ZD"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        // Global data storage
        let allTutors = [];
        let allStudents = [];
        let studentFee = 50; // Default fee

        // Check for super user authentication
        window.onload = function() {
            const superUserAuth = localStorage.getItem('superUserAuth');
            if (superUserAuth !== 'true') {
                alert('Unauthorized access! Redirecting to admin dashboard.');
                window.location.href = 'DashboardAdmin.html';
                return;
            }
            loadAllData();
        };

        async function loadAllData() {
            try {
                // Load student fee from Firebase
                const feeRef = ref(database, 'NUMBERS/STUDENT_FEE/NUMBER');
                const feeSnapshot = await get(feeRef);
                if (feeSnapshot.exists()) {
                    studentFee = feeSnapshot.val();
                }

                // Load tutors
                const tutorsRef = ref(database, 'ADMIN');
                const tutorsSnapshot = await get(tutorsRef);
                if (tutorsSnapshot.exists()) {
                    allTutors = Object.entries(tutorsSnapshot.val()).map(([key, value]) => ({
                        key,
                        ...value
                    }));
                }

                // Load students
                const studentsRef = ref(database, 'STUDENTS');
                const studentsSnapshot = await get(studentsRef);
                if (studentsSnapshot.exists()) {
                    allStudents = Object.entries(studentsSnapshot.val()).map(([key, value]) => ({
                        key,
                        ...value
                    }));
                }

                // Load classrooms count
                const classroomsRef = ref(database, 'CLASSROOMS');
                const classroomsSnapshot = await get(classroomsRef);
                let totalClassrooms = 0;
                if (classroomsSnapshot.exists()) {
                    totalClassrooms = Object.keys(classroomsSnapshot.val()).length;
                }

                // Display all data
                displayTutors();
                displayStudents();
                displayStats(totalClassrooms, allStudents.length, studentFee);
                
            } catch (error) {
                console.error('Error loading data:', error);
                alert('Error loading dashboard information. Please try again.');
            }
        }

        function displayTutors() {
            const container = document.getElementById('tutorsContainer');
            if (allTutors.length === 0) {
                container.innerHTML = '<p class="text-center">No tutors found</p>';
                return;
            }

            let html = '<table class="table table-striped table-hover">';
            html += '<thead class="bg-purple-800 text-white"><tr>';
            html += '<th>Tutor ID</th><th>Full Name</th><th>Email</th><th>Tel</th><th>Actions</th>';
            html += '</tr></thead><tbody>';

            allTutors.forEach(tutor => {
                html += `<tr data-tutor="${tutor.key}">`;
                html += `<td>${tutor.key}</td>`;
                html += `<td><span class="view-mode">${tutor.FULL_NAME || 'N/A'}</span>
                         <input type="text" class="edit-mode editable-field d-none" value="${tutor.FULL_NAME || ''}" data-field="FULL_NAME"></td>`;
                html += `<td><span class="view-mode">${tutor.EMAIL || 'N/A'}</span>
                         <input type="text" class="edit-mode editable-field d-none" value="${tutor.EMAIL || ''}" data-field="EMAIL"></td>`;
                html += `<td><span class="view-mode">${tutor.TEL || 'N/A'}</span>
                         <input type="text" class="edit-mode editable-field d-none" value="${tutor.TEL || ''}" data-field="TEL"></td>`;
                html += `<td>
                    <button class="btn btn-sm btn-primary edit-btn" onclick="editTutor('${tutor.key}')">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-sm btn-success save-btn d-none" onclick="saveTutor('${tutor.key}')">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button class="btn btn-sm btn-secondary cancel-btn d-none" onclick="cancelEdit('${tutor.key}', 'tutor')">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function displayStudents() {
            const container = document.getElementById('studentsContainer');
            if (allStudents.length === 0) {
                container.innerHTML = '<p class="text-center">No students found</p>';
                return;
            }

            let html = '<table class="table table-striped table-hover">';
            html += '<thead class="bg-purple-800 text-white"><tr>';
            html += '<th>Student ID</th><th>Full Name</th><th>Email</th><th>Tel</th><th>Actions</th>';
            html += '</tr></thead><tbody>';

            allStudents.forEach(student => {
                html += `<tr data-student="${student.key}">`;
                html += `<td>${student.key}</td>`;
                html += `<td><span class="view-mode">${student.FULL_NAME || 'N/A'}</span>
                         <input type="text" class="edit-mode editable-field d-none" value="${student.FULL_NAME || ''}" data-field="FULL_NAME"></td>`;
                html += `<td><span class="view-mode">${student.EMAIL || 'N/A'}</span>
                         <input type="text" class="edit-mode editable-field d-none" value="${student.EMAIL || ''}" data-field="EMAIL"></td>`;
                html += `<td><span class="view-mode">${student.TEL || 'N/A'}</span>
                         <input type="text" class="edit-mode editable-field d-none" value="${student.TEL || ''}" data-field="TEL"></td>`;
                html += `<td>
                    <button class="btn btn-sm btn-primary edit-btn" onclick="editStudent('${student.key}')">
                        <i class="fas fa-edit"></i> Edit
                    </button>
                    <button class="btn btn-sm btn-success save-btn d-none" onclick="saveStudent('${student.key}')">
                        <i class="fas fa-save"></i> Save
                    </button>
                    <button class="btn btn-sm btn-secondary cancel-btn d-none" onclick="cancelEdit('${student.key}', 'student')">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function displayStats(classrooms, students, fee) {
            const totalRevenue = students * fee;
            const statsContainer = document.getElementById('statsContainer');
            statsContainer.innerHTML = `
                <div class="col-md-4 mb-4">
                    <div class="card stat-card bg-gradient-to-br from-blue-500 to-blue-700 text-white">
                        <div class="card-body text-center">
                            <i class="fas fa-chalkboard-teacher fa-3x mb-3"></i>
                            <h3 class="text-4xl font-bold">${classrooms}</h3>
                            <p class="text-lg">Total Classrooms</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card stat-card bg-gradient-to-br from-green-500 to-green-700 text-white">
                        <div class="card-body text-center">
                            <i class="fas fa-user-graduate fa-3x mb-3"></i>
                            <h3 class="text-4xl font-bold">${students}</h3>
                            <p class="text-lg">Total Students</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4 mb-4">
                    <div class="card stat-card bg-gradient-to-br from-purple-500 to-purple-700 text-white">
                        <div class="card-body text-center">
                            <i class="fas fa-rupee-sign fa-3x mb-3"></i>
                            <h3 class="text-4xl font-bold">Rs ${totalRevenue}</h3>
                            <p class="text-lg">Total Revenue</p>
                            <div class="mt-3">
                                <label class="text-sm">Student Fee (Rs):</label>
                                <input type="number" id="studentFeeInput" value="${fee}" 
                                       class="form-control mx-auto" style="max-width: 150px; display: inline-block;"
                                       onchange="updateFee()">
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        window.updateFee = async function() {
            const newFee = parseInt(document.getElementById('studentFeeInput').value);
            if (isNaN(newFee) || newFee < 0) {
                alert('Please enter a valid positive number');
                return;
            }

            try {
                const feeRef = ref(database, 'NUMBERS/STUDENT_FEE/NUMBER');
                await set(feeRef, newFee);
                studentFee = newFee;
                
                // Reload classrooms count for stats update
                const classroomsRef = ref(database, 'CLASSROOMS');
                const classroomsSnapshot = await get(classroomsRef);
                let totalClassrooms = 0;
                if (classroomsSnapshot.exists()) {
                    totalClassrooms = Object.keys(classroomsSnapshot.val()).length;
                }
                
                displayStats(totalClassrooms, allStudents.length, studentFee);
                alert('Student fee updated successfully!');
            } catch (error) {
                console.error('Error updating fee:', error);
                alert('Failed to update fee. Please try again.');
            }
        };

        window.editTutor = function(tutorKey) {
            const row = document.querySelector(`tr[data-tutor="${tutorKey}"]`);
            row.querySelectorAll('.view-mode').forEach(el => el.classList.add('d-none'));
            row.querySelectorAll('.edit-mode').forEach(el => el.classList.remove('d-none'));
            row.querySelector('.edit-btn').classList.add('d-none');
            row.querySelector('.save-btn').classList.remove('d-none');
            row.querySelector('.cancel-btn').classList.remove('d-none');
        };

        window.editStudent = function(studentKey) {
            const row = document.querySelector(`tr[data-student="${studentKey}"]`);
            row.querySelectorAll('.view-mode').forEach(el => el.classList.add('d-none'));
            row.querySelectorAll('.edit-mode').forEach(el => el.classList.remove('d-none'));
            row.querySelector('.edit-btn').classList.add('d-none');
            row.querySelector('.save-btn').classList.remove('d-none');
            row.querySelector('.cancel-btn').classList.remove('d-none');
        };

        window.saveTutor = async function(tutorKey) {
            const row = document.querySelector(`tr[data-tutor="${tutorKey}"]`);
            const updates = {};
            
            row.querySelectorAll('.edit-mode').forEach(input => {
                updates[input.dataset.field] = input.value;
            });

            try {
                for (const [field, value] of Object.entries(updates)) {
                    await set(ref(database, `ADMIN/${tutorKey}/${field}`), value);
                }
                
                // Update local data
                const tutorIndex = allTutors.findIndex(t => t.key === tutorKey);
                if (tutorIndex !== -1) {
                    Object.assign(allTutors[tutorIndex], updates);
                }
                
                displayTutors();
                alert('Tutor updated successfully!');
            } catch (error) {
                console.error('Error updating tutor:', error);
                alert('Failed to update tutor. Please try again.');
            }
        };

        window.saveStudent = async function(studentKey) {
            const row = document.querySelector(`tr[data-student="${studentKey}"]`);
            const updates = {};
            
            row.querySelectorAll('.edit-mode').forEach(input => {
                updates[input.dataset.field] = input.value;
            });

            try {
                for (const [field, value] of Object.entries(updates)) {
                    await set(ref(database, `STUDENTS/${studentKey}/${field}`), value);
                }
                
                // Update local data
                const studentIndex = allStudents.findIndex(s => s.key === studentKey);
                if (studentIndex !== -1) {
                    Object.assign(allStudents[studentIndex], updates);
                }
                
                displayStudents();
                alert('Student updated successfully!');
            } catch (error) {
                console.error('Error updating student:', error);
                alert('Failed to update student. Please try again.');
            }
        };

        window.cancelEdit = function(key, type) {
            if (type === 'tutor') {
                displayTutors();
            } else {
                displayStudents();
            }
        };

        window.filterTutors = function() {
            const searchText = document.getElementById('tutorSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#tutorsContainer tr[data-tutor]');
            
            rows.forEach(row => {
                const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                if (name.includes(searchText)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        };

        window.filterStudents = function() {
            const searchText = document.getElementById('studentSearch').value.toLowerCase();
            const rows = document.querySelectorAll('#studentsContainer tr[data-student]');
            
            rows.forEach(row => {
                const name = row.querySelector('td:nth-child(2)').textContent.toLowerCase();
                if (name.includes(searchText)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        };
    </script>
</body>

</html>
