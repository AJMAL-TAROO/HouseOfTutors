<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard Logging Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .header {
            background: #6366f1;
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .test-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-section h3 {
            color: #333;
            margin-bottom: 15px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
        }
        .test-result.pass {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #10b981;
        }
        .test-result.info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #3b82f6;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
        }
        .btn-primary {
            background: #6366f1;
            color: white;
        }
        .btn-primary:hover {
            background: #4f46e5;
        }
        code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Admin Dashboard Logging Test</h1>
            <p>Testing the logging functionality for DashboardAdmin.html</p>
        </div>

        <div class="test-section">
            <h3>Test Overview</h3>
            <p>This test validates that the admin dashboard logging works correctly:</p>
            <ul>
                <li>‚úÖ Logs are captured on every page load</li>
                <li>‚úÖ Data is extracted from admin's VIRTUAL_ROOMS and STUDENTS sub-nodes</li>
                <li>‚úÖ Modal is only shown when accessing /info endpoint</li>
                <li>‚úÖ Console logs are always visible</li>
            </ul>
        </div>

        <div class="test-section">
            <h3>Test 1: Function Signature</h3>
            <button class="btn btn-primary" onclick="runTest1()">Run Test 1</button>
            <div id="test1-output"></div>
        </div>

        <div class="test-section">
            <h3>Test 2: checkForInfoEndpoint Logic</h3>
            <button class="btn btn-primary" onclick="runTest2()">Run Test 2</button>
            <div id="test2-output"></div>
        </div>

        <div class="test-section">
            <h3>Test 3: Conditional Modal Display</h3>
            <button class="btn btn-primary" onclick="runTest3()">Run Test 3</button>
            <div id="test3-output"></div>
        </div>

        <div class="test-section">
            <h3>Test 4: Data Extraction from Admin Sub-nodes</h3>
            <button class="btn btn-primary" onclick="runTest4()">Run Test 4</button>
            <div id="test4-output"></div>
        </div>

        <div class="test-section">
            <h3>Expected Behavior Summary</h3>
            <div class="test-result info">
                <strong>Normal Page Load (without /info):</strong><br>
                - captureAdminLogs called with showModal=false<br>
                - Console logs displayed<br>
                - No modal shown<br>
                - Data logged to Firebase
            </div>
            <div class="test-result info">
                <strong>Page Load with /info endpoint:</strong><br>
                - captureAdminLogs called with showModal=true<br>
                - Console logs displayed<br>
                - Modal shown with statistics<br>
                - Data logged to Firebase
            </div>
        </div>
    </div>

    <script>
        // Test 1: Verify function signature accepts showModal parameter
        function runTest1() {
            const output = document.getElementById('test1-output');
            output.innerHTML = '';
            
            try {
                // Simulate the function with default parameter
                function captureAdminLogs(adminEmail, adminKey, showModal = false) {
                    return { adminEmail, adminKey, showModal };
                }
                
                // Test with default parameter
                const result1 = captureAdminLogs('test@test.com', 'ADMIN_1');
                if (result1.showModal === false) {
                    output.innerHTML += '<div class="test-result pass">‚úÖ PASS: Default showModal=false works correctly</div>';
                }
                
                // Test with explicit true
                const result2 = captureAdminLogs('test@test.com', 'ADMIN_1', true);
                if (result2.showModal === true) {
                    output.innerHTML += '<div class="test-result pass">‚úÖ PASS: Explicit showModal=true works correctly</div>';
                }
                
                // Test with explicit false
                const result3 = captureAdminLogs('test@test.com', 'ADMIN_1', false);
                if (result3.showModal === false) {
                    output.innerHTML += '<div class="test-result pass">‚úÖ PASS: Explicit showModal=false works correctly</div>';
                }
                
            } catch (error) {
                output.innerHTML += '<div class="test-result" style="background:#fee; color:#c00;">‚ùå FAIL: ' + error.message + '</div>';
            }
        }

        // Test 2: Verify checkForInfoEndpoint logic
        function runTest2() {
            const output = document.getElementById('test2-output');
            output.innerHTML = '';
            
            // Note: This replicates the logic from DashboardAdmin.html for testing purposes
            // In production, this would ideally import the actual function
            function checkForInfoEndpoint() {
                const currentPath = window.location.pathname;
                const currentHash = window.location.hash;
                const currentHref = window.location.href;
                const currentPageName = currentPath.split('/').pop();
                
                if (currentPath.includes('/info') || 
                    currentHash.includes('/info') || 
                    currentHash === '#info' ||
                    (currentPageName && currentHref.includes(`${currentPageName}/info`))) {
                    return true;
                }
                return false;
            }
            
            const result = checkForInfoEndpoint();
            output.innerHTML += '<div class="test-result info">Current URL: <code>' + window.location.href + '</code></div>';
            output.innerHTML += '<div class="test-result info">Current Hash: <code>' + window.location.hash + '</code></div>';
            output.innerHTML += '<div class="test-result info">checkForInfoEndpoint returns: <code>' + result + '</code></div>';
            
            if (!result) {
                output.innerHTML += '<div class="test-result pass">‚úÖ PASS: Normal page load correctly returns false</div>';
            } else {
                output.innerHTML += '<div class="test-result pass">‚úÖ INFO: /info endpoint detected, returns true</div>';
            }
        }

        // Test 3: Verify conditional modal display
        function runTest3() {
            const output = document.getElementById('test3-output');
            output.innerHTML = '';
            
            function testModalLogic(showModal) {
                let modalShown = false;
                
                // Simulate the logic
                if (showModal) {
                    modalShown = true;
                }
                
                return modalShown;
            }
            
            const result1 = testModalLogic(false);
            if (!result1) {
                output.innerHTML += '<div class="test-result pass">‚úÖ PASS: Modal not shown when showModal=false</div>';
            }
            
            const result2 = testModalLogic(true);
            if (result2) {
                output.innerHTML += '<div class="test-result pass">‚úÖ PASS: Modal shown when showModal=true</div>';
            }
        }

        // Test 4: Verify data extraction logic
        function runTest4() {
            const output = document.getElementById('test4-output');
            output.innerHTML = '';
            
            // Simulate admin data from Firebase (using test data, not real emails)
            const adminData = {
                EMAIL: "test.admin@example.com",
                FULL_NAME: "Test Admin",
                STUDENTS: "STUDENTS_12,STUDENTS_13,STUDENTS_14",
                VIRTUAL_ROOMS: "1001,1002,1007,1008"
            };
            
            // Simulate the extraction logic
            const virtualRooms = adminData.VIRTUAL_ROOMS ? adminData.VIRTUAL_ROOMS.split(',').filter(room => room.trim()) : [];
            const classroomCount = virtualRooms.length;
            
            const studentsIds = adminData.STUDENTS ? adminData.STUDENTS.split(',').filter(id => id.trim()) : [];
            const studentCount = studentsIds.length;
            
            output.innerHTML += '<div class="test-result info">Admin: <code>' + adminData.EMAIL + '</code></div>';
            output.innerHTML += '<div class="test-result info">VIRTUAL_ROOMS: <code>' + adminData.VIRTUAL_ROOMS + '</code></div>';
            output.innerHTML += '<div class="test-result info">STUDENTS: <code>' + adminData.STUDENTS + '</code></div>';
            
            if (classroomCount === 4) {
                output.innerHTML += '<div class="test-result pass">‚úÖ PASS: Classroom count = ' + classroomCount + ' (extracted from VIRTUAL_ROOMS)</div>';
            }
            
            if (studentCount === 3) {
                output.innerHTML += '<div class="test-result pass">‚úÖ PASS: Student count = ' + studentCount + ' (extracted from STUDENTS)</div>';
            }
            
            // Test with empty values
            const emptyAdmin = { STUDENTS: "", VIRTUAL_ROOMS: "" };
            const emptyRooms = emptyAdmin.VIRTUAL_ROOMS ? emptyAdmin.VIRTUAL_ROOMS.split(',').filter(room => room.trim()) : [];
            const emptyStudents = emptyAdmin.STUDENTS ? emptyAdmin.STUDENTS.split(',').filter(id => id.trim()) : [];
            
            if (emptyRooms.length === 0 && emptyStudents.length === 0) {
                output.innerHTML += '<div class="test-result pass">‚úÖ PASS: Empty values handled correctly (counts = 0)</div>';
            }
        }

        // Show instructions on load
        window.onload = function() {
            console.log('Admin Dashboard Logging Test loaded');
            console.log('Run each test to verify the implementation');
        };
    </script>
</body>
</html>
